{% extends "base.html" %}

{% block header_title %}Настройки{% endblock %}

{% block content %}
<!-- Telegram Settings -->
<div class="section-header">Telegram</div>
<div class="card">
    <form hx-post="/api/settings/batch"
          hx-swap="none"
          hx-on::after-request="if(event.detail.successful) showToast('Сохранено!', 'success')">
        <div style="padding: 16px;">
            <div class="field label border round" style="margin-bottom: 0;">
                <input type="text" name="telegram_chat_id" value="{{ settings.get('telegram_chat_id', '') }}">
                <label>Chat ID</label>
            </div>
            <p class="secondary-text" style="font-size: 12px; margin: 8px 0 0;">ID чата для получения дайджестов</p>
        </div>
        <div class="divider"></div>
        <div style="padding: 12px 16px; display: flex; justify-content: flex-end;">
            <button type="submit" class="round small">
                <i>save</i>
                <span>Сохранить</span>
            </button>
        </div>
    </form>
</div>

<!-- Language Settings -->
<div class="section-header">Язык</div>
<div class="card">
    <form hx-post="/api/settings/batch"
          hx-swap="none"
          hx-on::after-request="if(event.detail.successful) showToast('Сохранено!', 'success')">
        <div style="padding: 16px;">
            <div class="field suffix border round" style="margin-bottom: 0;">
                <select name="digest_language">
                    <option value="ru" {% if settings.get('digest_language', 'ru') == 'ru' %}selected{% endif %}>Русский</option>
                    <option value="en" {% if settings.get('digest_language') == 'en' %}selected{% endif %}>English</option>
                </select>
                <i>arrow_drop_down</i>
            </div>
            <p class="secondary-text" style="font-size: 12px; margin: 8px 0 0;">Язык дайджестов</p>
        </div>
        <div class="divider"></div>
        <div style="padding: 12px 16px; display: flex; justify-content: flex-end;">
            <button type="submit" class="round small">
                <i>save</i>
                <span>Сохранить</span>
            </button>
        </div>
    </form>
</div>

<!-- System Info -->
<div class="section-header">О приложении</div>
<div class="card">
    <div class="list-tile">
        <div class="leading">
            <i>info</i>
        </div>
        <div class="content">
            <p class="title">Версия</p>
            <p class="subtitle">{{ version or '0.1.0' }}</p>
        </div>
    </div>
    <div class="divider" style="margin-left: 72px;"></div>
    <div class="list-tile">
        <div class="leading">
            <i>dns</i>
        </div>
        <div class="content">
            <p class="title">API</p>
            <p class="subtitle" id="api-status">Проверка...</p>
        </div>
        <span class="status-dot" id="api-status-dot"></span>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
fetch('/health')
    .then(r => r.json())
    .then(data => {
        document.getElementById('api-status').textContent = data.status || 'OK';
        document.getElementById('api-status-dot').classList.add('ok');
    })
    .catch(() => {
        document.getElementById('api-status').textContent = 'Недоступен';
        document.getElementById('api-status-dot').classList.add('error');
    });
</script>
{% endblock %}
